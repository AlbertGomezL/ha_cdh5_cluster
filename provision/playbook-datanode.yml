---
- hosts: all
  become: true
  tasks:
        
    - name: Crear usuario hadoop
      user:
        name: hadooop
        password: '*'
        state: present
    
    - name: Crear directorio ssh
      file:
        path: /home/hadoop/.ssh
        state: directory
        
    - name: Configurar clave publica
      copy:
        src: clave_hadoop.pub
        dest: /home/hadoop/.ssh/authorized_keys
          
    - name: Update APT package manager repositories cache
      apt:
        update_cache: yes
        
    - name: Install required packages
      apt:
        update_cache: yes
        name: "{{ packages }}"
        state: present
      vars:
        packages:
          - openjdk-7-jre-headless
          - openssh-client
          - rsync
          - wget
          - sshpass
         
    - name: Configurar hosts
      copy:
        src: hosts
        dest: /etc/hosts
        
    - name: Download CDH5 package
      get_url:
        url: http://archive.cloudera.com/cdh5/one-click-install/precise/amd64/cdh5-repository_1.0_all.deb
        dest: /vagrant
        force_basic_auth: yes

    - name: Install cdh5-repository.deb
      apt:
        deb: /vagrant/cdh5-repository_1.0_all.deb

    - name: Add Cloudera repository key
      apt_key:
        url: http://archive.cloudera.com/cdh5/ubuntu/precise/amd64/cdh/archive.key

    - name: Update apt packages
      apt:
        update_cache: yes
        force_apt_get: yes
            
    - name: Install tasktracker
      yum: 
        name: hadoop-0.20-mapreduce-tasktracker

    - name: Install datanode
      apt: 
        name: hadoop-hdfs-datanode

